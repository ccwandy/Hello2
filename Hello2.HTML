<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>é€£çºŒè¼¸å…¥ä¸¦é¡¯ç¤ºè³‡æ–™</title>
<style>
:root {
  --bg: #0b0c10; --card: #121319; --muted: #9aa0a6; --text: #e8eaed;
  --accent: #4f46e5; --accent-2: #22c55e; --danger: #ef4444; --border: #23252f;
}
* { box-sizing: border-box; }
body {
  margin: 0; padding: 24px;
  font-family: ui-sans-serif, -apple-system, "Noto Sans TC", Roboto, "Segoe UI", Helvetica, Arial;
  color: var(--text);
  background: radial-gradient(1200px 800px at 20% -10%, #12131a 0, var(--bg) 60%);
}
.container { max-width: 980px; margin: 0 auto; }
.card {
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0));
  border: 1px solid var(--border); border-radius: 18px; padding: 16px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.25);
}
h1 { font-size: 28px; margin: 0 0 12px; letter-spacing: 0.5px; }
p.desc { margin: 0 0 16px; color: var(--muted); }
.row { display: flex; gap: 12px; flex-wrap: wrap; }
.grow { flex: 1 1 180px; }
input[type="text"], select {
  width: 100%; padding: 12px 14px; border-radius: 12px;
  border: 1px solid var(--border); outline: none;
  background: #0f1117; color: var(--text); font-size: 16px;
}
input[type="text"]:focus, select:focus {
  border-color: var(--accent); box-shadow: 0 0 0 3px rgba(79,70,229,0.25);
}
button {
  border: 1px solid var(--border); border-radius: 12px; padding: 10px 14px;
  font-size: 14px; cursor: pointer; color: var(--text); background: #151824;
  transition: transform .04s ease, box-shadow .2s ease, background .2s ease;
}
button:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.25); }
button:active { transform: translateY(1px); }
.btn-primary { background: linear-gradient(180deg, #3438ff, #2a2edb); border-color: #2b2fe0; }
.btn-secondary { background: #182235; }
.btn-danger { background: linear-gradient(180deg, #ff5a5a, #e23e3e); border-color: #e23e3e; }
.toolbar { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
.toolbar .spacer { flex: 1; }
table { width: 100%; border-collapse: collapse; margin-top: 12px; }
thead th {
  text-align: left; font-weight: 600; color: var(--muted);
  border-bottom: 1px solid var(--border); padding: 10px;
}
tbody td {
  padding: 12px 10px; border-bottom: 1px dashed #1f2330; vertical-align: top;
}
tbody tr:hover { background: rgba(255,255,255,0.03); }
.empty { color: var(--muted); text-align: center; padding: 20px; }
</style>
<script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>
<div class="container">
  <div class="card" style="margin-bottom: 16px;">
    <h1>é€£çºŒè¼¸å…¥ä¸¦é¡¯ç¤ºè³‡æ–™</h1>
    <p class="desc">è¼¸å…¥è²¡ç”¢ç·¨è™Ÿã€æµæ°´ç¢¼ã€å‚™è¨»ã€åœ°é»èˆ‡æ–¹å¼ï¼Œé»ã€Œæ–°å¢ã€å³å¯åŠ å…¥æ¸…å–®ã€‚</p>
    <div class="row" style="margin-top: 8px;">
      <div class="grow">
        <label class="desc">QR Code æƒæ</label>
        <div style="display:flex; gap:8px; align-items:center;">
          <button id="startScanBtn" class="btn-secondary" type="button">é–‹å§‹æƒæ</button>
          <select id="zoomSelect">
            <option value="1" selected>1å€ (é è¨­)</option>
            <option value="5">5å€</option>
            <option value="10">10å€</option>
            <option value="20">20å€</option>
            <option value="30">30å€</option>
            <option value="40">40å€</option>
            <option value="50">50å€</option>
          </select>
          <span id="zoomLabel" class="desc">ç›®å‰å€ç‡: 1x</span>
        </div>
        <div id="qrReader" style="width:100%; max-width:400px; margin-top:8px; display:none;"></div>
      </div>
      <div class="grow">
        <label class="desc">è²¡ç”¢ç·¨è™Ÿ</label>
        <input id="propIdInput" type="text" placeholder="Exï¼šè‹±æ–‡å­—æ¯+6ä½æ•¸å­—ã€10ä½æ•¸å­—" />
      </div>
      <div class="grow">
        <label class="desc">æµæ°´ç¢¼</label>
        <input id="serialInput" type="text" placeholder="Exï¼š0001ã€1" />
      </div>
      <div class="grow">
        <label class="desc">å‚™è¨»</label>
        <input id="noteInput" type="text" placeholder="Exï¼šå·¥è™Ÿã€äººå" />
      </div>
      <div class="grow">
        <label class="desc">åœ°é»</label>
        <select id="locationSelect">
          <option value="å¥‡å²©">å¥‡å²©</option>
          <option value="æ·¡æ°´">æ·¡æ°´</option>
        </select>
      </div>
      <div class="grow">
        <label class="desc">æ–¹å¼</label>
        <select id="methodSelect">
          <option value="é€ä¾†">é€ä¾†</option>
          <option value="å–å›">å–å›</option>
        </select>
      </div>
    </div>
    <div class="toolbar" style="margin-top: 12px;">
      <button id="addBtn" class="btn-primary" type="button">æ–°å¢</button>
      <button id="exportCsvBtn" class="btn-secondary" type="button">åŒ¯å‡º CSV</button>
      <button id="exportJsonBtn" class="btn-secondary" type="button">åŒ¯å‡º JSON</button>
      <label for="importFile" class="btn-secondary" style="display:inline-block;">åŒ¯å…¥</label>
      <input id="importFile" type="file" accept=".csv,.json" style="display:none" />
      <div class="spacer"></div>
      <button id="clearBtn" class="btn-danger" type="button">æ¸…é™¤è¼¸å…¥</button>
    </div>
  </div>

  <div class="card">
    <div class="row" style="justify-content: space-between; align-items:center; margin-bottom: 6px;">
      <h2 style="margin:0; font-size:20px;">è³‡æ–™æ¸…å–®</h2>
      <div class="desc">å…± <span id="count">0</span> ç­†</div>
      <button id="clearBtn2" class="btn-danger" type="button" style="margin-left: auto;">æ¸…é™¤å…¨éƒ¨</button>
    </div>
    <div style="overflow:auto;">
      <table>
        <thead>
          <tr>
            <th style="width: 60px;">åºè™Ÿ</th>
            <th>è²¡ç”¢ç·¨è™Ÿ</th>
            <th>æµæ°´ç¢¼</th>
            <th>å‚™è¨»</th>
            <th>åœ°é»</th>
            <th>æ–¹å¼</th>
            <th style="width: 180px;">æ™‚é–“</th>
            <th style="width: 160px;">æ“ä½œ</th>
          </tr>
        </thead>
        <tbody id="tbody">
          <tr><td colspan="8" class="empty">ç›®å‰æ²’æœ‰è³‡æ–™ï¼Œè«‹å¾ä¸Šæ–¹è¼¸å…¥æ–°å¢ã€‚</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
// ====== QR Code æ”¾å¤§å€ç‡è™•ç† ======
let qrScanner=null;
const startScanBtn=document.getElementById('startScanBtn');
const qrReader=document.getElementById('qrReader');
const zoomSelect=document.getElementById('zoomSelect');
const zoomLabel=document.getElementById('zoomLabel');

// è¨ˆç®—å€ç‡å°æ‡‰çš„ qrbox å¤§å°
function getQrboxSize(zoom) {
  return Math.max(100, 250 / (zoom / 1));
}

startScanBtn.addEventListener('click', ()=>{
  if(qrScanner){
    qrScanner.stop().then(()=>{
      qrScanner.clear(); qrReader.style.display='none'; qrScanner=null;
      startScanBtn.textContent='é–‹å§‹æƒæ';
    });
  } else {
    qrReader.style.display='block';
    qrScanner = new Html5Qrcode("qrReader");

    let zoom = parseInt(zoomSelect.value, 10);
    let qrboxSize = getQrboxSize(zoom);

    qrScanner.start(
      {facingMode:"environment"},
      {fps:10, qrbox: qrboxSize},
      qrCodeMessage=>{
        alert("æƒææˆåŠŸ: " + qrCodeMessage);
        qrScanner.stop().then(()=>{
          qrScanner.clear(); qrReader.style.display='none'; qrScanner=null;
          startScanBtn.textContent='é–‹å§‹æƒæ';
        });
      }
    ).then(()=>{ startScanBtn.textContent='åœæ­¢æƒæ'; })
     .catch(err=>{ alert("ç„¡æ³•å•Ÿå‹•ç›¸æ©Ÿ: " + err); });
  }
});

// ğŸ”¹ æƒæé€²è¡Œä¸­å‹•æ…‹åˆ‡æ›å€ç‡
zoomSelect.addEventListener('change', ()=>{
  let zoom = parseInt(zoomSelect.value, 10);
  zoomLabel.textContent = `ç›®å‰å€ç‡: ${zoom}x`;
  if(qrScanner){
    let qrboxSize = getQrboxSize(zoom);
    qrScanner._config.qrbox = qrboxSize;  
    console.log("å€ç‡åˆ‡æ›ç‚º:", zoom, "å€ -> qrbox =", qrboxSize);
  }
});
</script>
</body>
</html>
